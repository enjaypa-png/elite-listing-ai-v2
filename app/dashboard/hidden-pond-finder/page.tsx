'use client';

import { useState } from 'react';
import Link from 'next/link';
import { TopNav, Breadcrumbs } from '@/components/navigation';
import { Card, Button } from '@/components/ui';
import tokens from '@/design-system/tokens.json';

export default function HiddenPondFinderPage() {
  const [step, setStep] = useState<'input' | 'suggestions' | 'analysis'>('input');
  const [productType, setProductType] = useState('');
  const [category, setCategory] = useState('');
  const [nicheSuggestions, setNicheSuggestions] = useState<string[]>([]);
  const [checkedNiches, setCheckedNiches] = useState<any[]>([]);

  const generateNiches = () => {
    const angles = {
      material: ['ceramic', 'stoneware', 'porcelain', 'glass', 'metal'],
      size: ['small', 'large', '8oz', '12oz', '16oz', '20oz'],
      style: ['minimalist', 'vintage', 'modern', 'rustic', 'boho'],
      useCase: ['office', 'camping', 'travel', 'home', 'gym'],
      recipient: ['mom', 'dad', 'teacher', 'coworker', 'friend'],
      occasion: ['birthday', 'wedding', 'christmas', 'graduation'],
    };

    const niches: string[] = [];
    Object.entries(angles).forEach(([angleType, modifiers]) => {
      modifiers.forEach(modifier => {
        niches.push(`${modifier} ${productType}`);
      });
    });

    setNicheSuggestions(niches.slice(0, 20));
    setStep('suggestions');
  };

  if (step === 'input') {
    return (
      <div style={{ minHeight: '100vh', background: tokens.colors.background }}>
        <TopNav />
        
        <div style={{\n          maxWidth: '1000px',\n          margin: '0 auto',\n          padding: `${tokens.spacing[12]} ${tokens.spacing[4]}`\n        }}>\n          <Breadcrumbs />\n\n          <div style={{ textAlign: 'center', marginBottom: tokens.spacing[12] }}>\n            <h1 style={{\n              fontSize: tokens.typography.fontSize['5xl'],\n              fontWeight: tokens.typography.fontWeight.bold,\n              color: tokens.colors.text,\n              marginBottom: tokens.spacing[4]\n            }}>\n              \ud83c\udfdd Find Your Hidden Pond\n            </h1>\n            <p style={{\n              fontSize: tokens.typography.fontSize.xl,\n              color: tokens.colors.textMuted,\n              maxWidth: '700px',\n              margin: '0 auto'\n            }}>\n              Most sellers fish in oversaturated ponds. We'll help you find hidden ponds \n              with less competition and better profit potential.\n            </p>\n          </div>\n\n          <Card>\n            <div style={{ padding: tokens.spacing[8], maxWidth: '700px', margin: '0 auto' }}>\n              <h2 style={{\n                fontSize: tokens.typography.fontSize['2xl'],\n                fontWeight: tokens.typography.fontWeight.semibold,\n                color: tokens.colors.text,\n                marginBottom: tokens.spacing[6]\n              }}>\n                What are you thinking about making?\n              </h2>\n\n              <div style={{ display: 'flex', flexDirection: 'column', gap: tokens.spacing[6] }}>\n                <div>\n                  <label style={{\n                    display: 'block',\n                    fontSize: tokens.typography.fontSize.sm,\n                    fontWeight: tokens.typography.fontWeight.medium,\n                    color: tokens.colors.text,\n                    marginBottom: tokens.spacing[2]\n                  }}>\n                    Product Type\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={productType}\n                    onChange={(e) => setProductType(e.target.value)}\n                    placeholder=\"e.g., coffee mug, tote bag, jewelry\"\n                    style={{\n                      width: '100%',\n                      padding: tokens.spacing[3],\n                      background: tokens.colors.surface,\n                      border: `1px solid ${tokens.colors.border}`,\n                      borderRadius: tokens.radius.md,\n                      color: tokens.colors.text,\n                      fontSize: tokens.typography.fontSize.base\n                    }}\n                  />\n                  <p style={{\n                    fontSize: tokens.typography.fontSize.xs,\n                    color: tokens.colors.textMuted,\n                    marginTop: tokens.spacing[2]\n                  }}>\n                    Be general - we'll find specific niches for you\n                  </p>\n                </div>\n\n                <div>\n                  <label style={{\n                    display: 'block',\n                    fontSize: tokens.typography.fontSize.sm,\n                    fontWeight: tokens.typography.fontWeight.medium,\n                    color: tokens.colors.text,\n                    marginBottom: tokens.spacing[2]\n                  }}>\n                    Category\n                  </label>\n                  <select\n                    value={category}\n                    onChange={(e) => setCategory(e.target.value)}\n                    style={{\n                      width: '100%',\n                      padding: tokens.spacing[3],\n                      background: tokens.colors.surface,\n                      border: `1px solid ${tokens.colors.border}`,\n                      borderRadius: tokens.radius.md,\n                      color: tokens.colors.text,\n                      fontSize: tokens.typography.fontSize.base\n                    }}\n                  >\n                    <option value=\"\">Select category</option>\n                    <option value=\"home-living\">Home & Living</option>\n                    <option value=\"jewelry\">Jewelry & Accessories</option>\n                    <option value=\"clothing\">Clothing & Shoes</option>\n                    <option value=\"art\">Art & Collectibles</option>\n                    <option value=\"craft-supplies\">Craft Supplies</option>\n                    <option value=\"toys-games\">Toys & Games</option>\n                    <option value=\"paper-party\">Paper & Party Supplies</option>\n                  </select>\n                </div>\n\n                <Button\n                  variant=\"primary\"\n                  size=\"lg\"\n                  fullWidth\n                  onClick={generateNiches}\n                  disabled={!productType || !category}\n                >\n                  Find Hidden Ponds \u2192\n                </Button>\n              </div>\n            </div>\n          </Card>\n        </div>\n      </div>\n    );\n  }

  if (step === 'suggestions') {
    return (\n      <div style={{ minHeight: '100vh', background: tokens.colors.background }}>\n        <TopNav />\n        \n        <div style={{\n          maxWidth: '1200px',\n          margin: '0 auto',\n          padding: `${tokens.spacing[12]} ${tokens.spacing[4]}`\n        }}>\n          <Breadcrumbs />\n\n          <div style={{ marginBottom: tokens.spacing[12] }}>\n            <h1 style={{\n              fontSize: tokens.typography.fontSize['4xl'],\n              fontWeight: tokens.typography.fontWeight.bold,\n              color: tokens.colors.text,\n              marginBottom: tokens.spacing[4]\n            }}>\n              Check These Niche Variations on Etsy\n            </h1>\n            <p style={{ fontSize: tokens.typography.fontSize.lg, color: tokens.colors.textMuted }}>\n              We generated {nicheSuggestions.length} niche variations for \"{productType}\". \n              Check the top 5-10 on Etsy Marketplace Insights to see which are hidden ponds.\n            </p>\n          </div>\n\n          <div style={{\n            background: `${tokens.colors.primary}1A`,\n            border: `1px solid ${tokens.colors.primary}33`,\n            borderRadius: tokens.radius.md,\n            padding: tokens.spacing[6],\n            marginBottom: tokens.spacing[8]\n          }}>\n            <h3 style={{\n              fontWeight: tokens.typography.fontWeight.semibold,\n              color: tokens.colors.text,\n              marginBottom: tokens.spacing[3],\n              display: 'flex',\n              alignItems: 'center',\n              gap: tokens.spacing[2]\n            }}>\n              <span>\ud83d\udcca</span> How to Check on Etsy:\n            </h3>\n            <ol style={{\n              display: 'flex',\n              flexDirection: 'column',\n              gap: tokens.spacing[2],\n              fontSize: tokens.typography.fontSize.sm,\n              color: tokens.colors.textMuted,\n              paddingLeft: 0,\n              listStyle: 'none'\n            }}>\n              <li>1. Click \"Check on Etsy \u2192\" next to any keyword below</li>\n              <li>2. Etsy Marketplace Insights will open in a new tab</li>\n              <li>3. Search for that exact keyword</li>\n              <li>4. Copy the \"Searches\" and \"Search results\" numbers</li>\n              <li>5. Come back here and enter the data</li>\n            </ol>\n          </div>\n\n          <div style={{ display: 'flex', flexDirection: 'column', gap: tokens.spacing[4] }}>\n            {nicheSuggestions.map((niche, index) => (\n              <Card key={index}>\n                <div style={{ padding: tokens.spacing[6] }}>\n                  <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: tokens.spacing[4] }}>\n                    <div>\n                      <div style={{\n                        fontSize: tokens.typography.fontSize.lg,\n                        fontWeight: tokens.typography.fontWeight.semibold,\n                        color: tokens.colors.text,\n                        marginBottom: tokens.spacing[1]\n                      }}>\n                        \"{niche}\"\n                      </div>\n                      <div style={{ fontSize: tokens.typography.fontSize.sm, color: tokens.colors.textMuted }}>\n                        Variation #{index + 1}\n                      </div>\n                    </div>\n                    <a\n                      href={`https://www.etsy.com/your/shops/me/stats/marketplace-insights?search=${encodeURIComponent(niche)}`}\n                      target=\"_blank\"\n                      rel=\"noopener noreferrer\"\n                      style={{\n                        padding: `${tokens.spacing[2]} ${tokens.spacing[4]}`,\n                        border: `2px solid ${tokens.colors.primary}`,\n                        color: tokens.colors.primary,\n                        borderRadius: tokens.radius.md,\n                        fontWeight: tokens.typography.fontWeight.semibold,\n                        textDecoration: 'none',\n                        display: 'inline-block'\n                      }}\n                    >\n                      Check on Etsy \u2192\n                    </a>\n                  </div>\n\n                  <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: tokens.spacing[4] }}>\n                    <div>\n                      <label style={{\n                        display: 'block',\n                        fontSize: tokens.typography.fontSize.xs,\n                        color: tokens.colors.textMuted,\n                        marginBottom: tokens.spacing[1]\n                      }}>\n                        Searches (last 30 days)\n                      </label>\n                      <input\n                        type=\"number\"\n                        placeholder=\"e.g., 34\"\n                        style={{\n                          width: '100%',\n                          padding: `${tokens.spacing[2]} ${tokens.spacing[3]}`,\n                          background: tokens.colors.background,\n                          border: `1px solid ${tokens.colors.border}`,\n                          borderRadius: tokens.radius.sm,\n                          color: tokens.colors.text\n                        }}\n                        onChange={(e) => {\n                          const updated = [...checkedNiches];\n                          const existing = updated.find(n => n.niche === niche);\n                          if (existing) {\n                            existing.searches = parseInt(e.target.value) || 0;\n                          } else {\n                            updated.push({ niche, searches: parseInt(e.target.value) || 0, results: 0 });\n                          }\n                          setCheckedNiches(updated);\n                        }}\n                      />\n                    </div>\n                    <div>\n                      <label style={{\n                        display: 'block',\n                        fontSize: tokens.typography.fontSize.xs,\n                        color: tokens.colors.textMuted,\n                        marginBottom: tokens.spacing[1]\n                      }}>\n                        Search Results\n                      </label>\n                      <input\n                        type=\"number\"\n                        placeholder=\"e.g., 5600\"\n                        style={{\n                          width: '100%',\n                          padding: `${tokens.spacing[2]} ${tokens.spacing[3]}`,\n                          background: tokens.colors.background,\n                          border: `1px solid ${tokens.colors.border}`,\n                          borderRadius: tokens.radius.sm,\n                          color: tokens.colors.text\n                        }}\n                        onChange={(e) => {\n                          const updated = [...checkedNiches];\n                          const existing = updated.find(n => n.niche === niche);\n                          if (existing) {\n                            existing.results = parseInt(e.target.value) || 0;\n                          } else {\n                            updated.push({ niche, searches: 0, results: parseInt(e.target.value) || 0 });\n                          }\n                          setCheckedNiches(updated);\n                        }}\n                      />\n                    </div>\n                  </div>\n                </div>\n              </Card>\n            ))}\n          </div>\n\n          <div style={{ display: 'flex', gap: tokens.spacing[4], marginTop: tokens.spacing[8] }}>\n            <Button\n              variant=\"secondary\"\n              size=\"lg\"\n              onClick={() => setStep('input')}\n            >\n              \u2190 Back\n            </Button>\n            <Button\n              variant=\"primary\"\n              size=\"lg\"\n              fullWidth\n              onClick={() => setStep('analysis')}\n              disabled={checkedNiches.filter(n => n.searches > 0 && n.results > 0).length === 0}\n            >\n              Analyze Hidden Ponds ({checkedNiches.filter(n => n.searches > 0 && n.results > 0).length})\n            </Button>\n          </div>\n        </div>\n      </div>\n    );\n  }

  const analyzed = checkedNiches\n    .filter(n => n.searches > 0 && n.results > 0)\n    .map(n => {\n      const ratio = n.searches / n.results;\n      let score = 1;\n      if (ratio >= 0.01) score = 10;\n      else if (ratio >= 0.005) score = 9;\n      else if (ratio >= 0.003) score = 8;\n      else if (ratio >= 0.002) score = 7;\n      else if (ratio >= 0.0015) score = 6;\n      else if (ratio >= 0.001) score = 4;\n      else if (ratio >= 0.0005) score = 2;\n\n      let verdict = 'Wrong Pond';\n      let color = tokens.colors.danger;\n      if (score >= 7) {\n        verdict = 'Hidden Pond';\n        color = tokens.colors.success;\n      } else if (score >= 4) {\n        verdict = 'Crowded Pond';\n        color = tokens.colors.warning;\n      }\n\n      return { ...n, ratio, score, verdict, color };\n    })\n    .sort((a, b) => b.score - a.score);\n\n  return (\n    <div style={{ minHeight: '100vh', background: tokens.colors.background }}>\n      <TopNav />\n      \n      <div style={{\n        maxWidth: '1200px',\n        margin: '0 auto',\n        padding: `${tokens.spacing[12]} ${tokens.spacing[4]}`\n      }}>\n        <Breadcrumbs />\n\n        <div style={{ marginBottom: tokens.spacing[12] }}>\n          <h1 style={{\n            fontSize: tokens.typography.fontSize['4xl'],\n            fontWeight: tokens.typography.fontWeight.bold,\n            color: tokens.colors.text,\n            marginBottom: tokens.spacing[4]\n          }}>\n            \ud83c\udfdd Your Hidden Pond Analysis\n          </h1>\n          <p style={{ fontSize: tokens.typography.fontSize.lg, color: tokens.colors.textMuted }}>\n            Based on REAL Etsy data you provided. Here's what we found:\n          </p>\n        </div>\n\n        <div style={{ display: 'flex', flexDirection: 'column', gap: tokens.spacing[6] }}>\n          {analyzed.map((result, index) => (\n            <div\n              key={index}\n              style={{\n                border: `2px solid ${result.color}33`,\n                borderRadius: tokens.radius.md,\n                padding: tokens.spacing[6],\n                background: `${result.color}0D`\n              }}\n            >\n              <div style={{ display: 'flex', alignItems: 'start', justifyContent: 'space-between', marginBottom: tokens.spacing[4] }}>\n                <div style={{ flex: 1 }}>\n                  <div style={{ display: 'flex', alignItems: 'center', gap: tokens.spacing[3], marginBottom: tokens.spacing[2] }}>\n                    <h3 style={{\n                      fontSize: tokens.typography.fontSize.xl,\n                      fontWeight: tokens.typography.fontWeight.bold,\n                      color: tokens.colors.text\n                    }}>\n                      \"{result.niche}\"\n                    </h3>\n                    <span style={{\n                      padding: `${tokens.spacing[1]} ${tokens.spacing[3]}`,\n                      borderRadius: tokens.radius.sm,\n                      fontSize: tokens.typography.fontSize.sm,\n                      fontWeight: tokens.typography.fontWeight.semibold,\n                      background: result.color,\n                      color: 'white'\n                    }}>\n                      {result.verdict}\n                    </span>\n                  </div>\n                  <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: tokens.spacing[6], fontSize: tokens.typography.fontSize.sm }}>\n                    <div>\n                      <div style={{ color: tokens.colors.textMuted, marginBottom: tokens.spacing[1] }}>Searches</div>\n                      <div style={{ fontSize: tokens.typography.fontSize['2xl'], fontWeight: tokens.typography.fontWeight.bold, color: tokens.colors.text }}>\n                        {result.searches.toLocaleString()}\n                      </div>\n                    </div>\n                    <div>\n                      <div style={{ color: tokens.colors.textMuted, marginBottom: tokens.spacing[1] }}>Results</div>\n                      <div style={{ fontSize: tokens.typography.fontSize['2xl'], fontWeight: tokens.typography.fontWeight.bold, color: tokens.colors.text }}>\n                        {result.results.toLocaleString()}\n                      </div>\n                    </div>\n                    <div>\n                      <div style={{ color: tokens.colors.textMuted, marginBottom: tokens.spacing[1] }}>Ratio</div>\n                      <div style={{ fontSize: tokens.typography.fontSize['2xl'], fontWeight: tokens.typography.fontWeight.bold, color: tokens.colors.text }}>\n                        {result.ratio.toFixed(5)}\n                      </div>\n                    </div>\n                  </div>\n                </div>\n                <div style={{ textAlign: 'right' }}>\n                  <div style={{\n                    fontSize: tokens.typography.fontSize['5xl'],\n                    fontWeight: tokens.typography.fontWeight.bold,\n                    color: result.color\n                  }}>\n                    {result.score}/10\n                  </div>\n                  <div style={{ fontSize: tokens.typography.fontSize.sm, color: tokens.colors.textMuted }}>Score</div>\n                </div>\n              </div>\n\n              <div style={{\n                background: tokens.colors.background,\n                borderRadius: tokens.radius.sm,\n                padding: tokens.spacing[4],\n                marginBottom: tokens.spacing[4]\n              }}>\n                <div style={{\n                  fontWeight: tokens.typography.fontWeight.semibold,\n                  color: tokens.colors.text,\n                  marginBottom: tokens.spacing[2]\n                }}>\n                  \ud83d\udca1 Recommendation:\n                </div>\n                <p style={{ fontSize: tokens.typography.fontSize.sm, color: tokens.colors.textMuted }}>\n                  {result.score >= 7 ? \n                    `Excellent opportunity! This is a hidden pond with low competition and decent demand. Strong candidate for your next product.` :\n                  result.score >= 4 ?\n                    `Competitive but achievable. You'll need strong optimization (250+/285 R.A.N.K. score) to rank well here.` :\n                    `Wrong pond - avoid this keyword. Too much competition relative to demand. Try a more specific niche.`\n                  }\n                </p>\n              </div>\n\n              {result.score >= 7 && (\n                <Button variant=\"primary\" size=\"lg\" fullWidth>\n                  Generate Listing for This Niche \u2192\n                </Button>\n              )}\n            </div>\n          ))}\n        </div>\n\n        <div style={{ display: 'flex', gap: tokens.spacing[4], marginTop: tokens.spacing[12] }}>\n          <Button variant=\"secondary\" size=\"lg\" onClick={() => setStep('suggestions')}>\n            \u2190 Check More Niches\n          </Button>\n          <Button\n            variant=\"ghost\"\n            size=\"lg\"\n            fullWidth\n            onClick={() => {\n              setStep('input');\n              setProductType('');\n              setCategory('');\n              setNicheSuggestions([]);\n              setCheckedNiches([]);\n            }}\n          >\n            Start Over with New Product\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n}\n"